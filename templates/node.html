{% extends 'base.html' %}

{% block title %}Node.js Documentation - SN VERSE{% endblock %}

{% block head %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #212529;
        }
        .sidebar {
            position: fixed;
            top: 70px;
            left: 0;
            width: 280px;
            height: calc(100vh - 70px);
            background: #343a40;
            border-right: 1px solid #495057;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar .nav-link {
            color: #adb5bd;
            padding: 12px 20px;
            border-radius: 0;
            margin: 0;
            transition: all 0.2s ease;
            font-weight: 500;
            border-left: 3px solid transparent;
        }
        .sidebar .nav-link:hover {
            background: #495057;
            color: #fff;
            text-decoration: none;
            border-left-color: #61dafb;
        }
        .sidebar .nav-link.active {
            background: #61dafb;
            color: #212529;
            border-left-color: #61dafb;
        }
        .main-content {
            margin-left: 280px;
            padding: 30px 0;
            max-width: 1200px;
        }

        .content-card {
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            background: #fff;
        }
        .content-card .card-header {
            background: #61dafb;
            color: #212529;
            font-weight: 600;
            font-size: 1.1rem;
            border-bottom: 1px solid #dee2e6;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
        }
        .search-container {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .accordion-button:not(.collapsed) {
            background: #e6f7ff;
            color: #61dafb;
            font-weight: 500;
        }
        .accordion-button {
            border-radius: 0;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .accordion-button:focus {
            box-shadow: none;
        }
        .badge-note {
            background: #e9ecef;
            color: #495057;
            font-weight: 500;
        }
        .badge-tip {
            background: #d1ecf1;
            color: #0c5460;
            font-weight: 500;
        }
        .btn {
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .copy-button {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .copy-button:hover {
            background: #5a6268;
            transform: scale(1.05);
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', sans-serif;
            color: #212529;
            font-weight: 600;
        }
        .card-body {
            padding: 20px;
        }
        .table {
            margin-bottom: 0;
        }
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            border-top: none;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .node-logo {
            color: #68a063;
            font-weight: 700;
        }
        .data-type-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #61dafb;
        }
        .method-table {
            width: 100%;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        .method-table th {
            background-color: #e9ecef;
            text-align: left;
            padding: 8px;
        }
        .method-table td {
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
        }
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
    <script>
        hljs.highlightAll();
    </script>
{% endblock %}

{% block content %}
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="p-3">
            <h5 class="text-center mb-3" style="font-size: 1.1rem; color: #fff; font-weight: 600;"><i class="fab fa-node-js"></i> <span class="node-logo">Node.js</span> Documentation</h5>

            <!-- Search Box -->
            <div class="search-container">
                <input type="text" id="search-input" class="form-control" placeholder="Search documentation..." style="background: rgba(255,255,255,0.9); border: 1px solid #495057; color: #212529;">
                <button class="btn btn-sm btn-outline-dark mt-2 w-100" onclick="clearSearch()">Clear Search</button>
            </div>

            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="#module1"><i class="fas fa-info-circle"></i> Module 1: Introduction to Node.js</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module2"><i class="fas fa-cogs"></i> Module 2: Setup and Installation</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module3"><i class="fas fa-code"></i> Module 3: Core Concepts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module4"><i class="fas fa-folder"></i> Module 4: File System Operations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module5"><i class="fas fa-globe"></i> Module 5: HTTP Module and Web Servers</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module6"><i class="fas fa-rocket"></i> Module 6: Express.js Framework</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module7"><i class="fas fa-database"></i> Module 7: Database Integration</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module8"><i class="fas fa-shield-alt"></i> Module 8: Authentication and Security</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module9"><i class="fas fa-project-diagram"></i> Module 9: Building RESTful APIs</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module10"><i class="fas fa-exclamation-triangle"></i> Module 10: Error Handling</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module11"><i class="fas fa-vial"></i> Module 11: Testing Node.js Applications</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module12"><i class="fas fa-tachometer-alt"></i> Module 12: Performance Optimization</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module13"><i class="fas fa-stream"></i> Module 13: Streams and Buffers</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module14"><i class="fas fa-star"></i> Module 14: Node.js Best Practices</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#module15"><i class="fas fa-lightbulb"></i> Module 15: Real-World Examples</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div id="content">
            <h1 class="mb-4" style="text-align: center;"><span class="node-logo">Node.js</span> Documentation</h1>
            <p style="text-align: center; font-size: 1.1rem; color: #6c757d;">Complete guide to Node.js from basics to advanced</p>

            <!-- Module 1: Introduction to Node.js -->
            <div class="content-card" id="module1">
                <div class="card-header">
                    <i class="fas fa-info-circle"></i> Module 1: Introduction to Node.js
                </div>
                <div class="card-body">
                    <h5>What is Node.js?</h5>
                    <p>Node.js is an open-source, cross-platform JavaScript runtime environment that executes JavaScript code outside a web browser. It allows developers to use JavaScript to write command line tools and for server-side scripting.</p>

                    <h5>Key Features</h5>
                    <ul>
                        <li><strong>Asynchronous and Event-Driven</strong> - All APIs are asynchronous and non-blocking</li>
                        <li><strong>Single-Threaded</strong> - Uses a single thread with event looping for scalability</li>
                        <li><strong>High Performance</strong> - Built on Google Chrome's V8 JavaScript engine</li>
                        <li><strong>NPM Ecosystem</strong> - Largest ecosystem of open-source libraries</li>
                        <li><strong>Cross-Platform</strong> - Runs on Windows, macOS, and Linux</li>
                    </ul>

                    <h5>Why Node.js?</h5>
                    <div class="data-type-section">
                        <h6>Performance Benefits</h6>
                        <p>Node.js's event-driven, non-blocking I/O model makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices.</p>
                        
                        <h6>Full-Stack JavaScript</h6>
                        <p>With Node.js, you can use JavaScript for both frontend and backend development, simplifying the development process and reducing context switching.</p>
                        
                        <h6>Rich Ecosystem</h6>
                        <p>Node Package Manager (NPM) provides access to thousands of libraries, making development faster and more efficient.</p>
                    </div>

                    <h5>Node.js vs Other Backend Technologies</h5>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Node.js</th>
                                <th>Python (Django)</th>
                                <th>Java (Spring)</th>
                                <th>PHP (Laravel)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Performance</td>
                                <td>Excellent</td>
                                <td>Good</td>
                                <td>Excellent</td>
                                <td>Good</td>
                            </tr>
                            <tr>
                                <td>Learning Curve</td>
                                <td>Moderate</td>
                                <td>Easy</td>
                                <td>Steep</td>
                                <td>Easy</td>
                            </tr>
                            <tr>
                                <td>Scalability</td>
                                <td>Excellent</td>
                                <td>Good</td>
                                <td>Excellent</td>
                                <td>Good</td>
                            </tr>
                            <tr>
                                <td>Ecosystem</td>
                                <td>Excellent</td>
                                <td>Good</td>
                                <td>Good</td>
                                <td>Good</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Module 2: Setup and Installation -->
            <div class="content-card" id="module2">
                <div class="card-header">
                    <i class="fas fa-cogs"></i> Module 2: Setup and Installation
                </div>
                <div class="card-body">
                    <h5>Prerequisites</h5>
                    <p>Before starting with Node.js, ensure you have:</p>
                    <ul>
                        <li>Basic knowledge of JavaScript</li>
                        <li>Familiarity with command line/terminal</li>
                        <li>Text editor or IDE (VS Code, WebStorm, etc.)</li>
                    </ul>

                    <h5>Installation Methods</h5>
                    
                    <h6>Using Version Manager (Recommended)</h6>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install NVM (Node Version Manager)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# Reload your shell
source ~/.bashrc

# Install latest LTS version
nvm install --lts

# Use specific version
nvm use 18.17.0

# List installed versions
nvm ls

# Switch between versions
nvm use 16.20.0</code></pre>
                    {% endraw %}

                    <h6>Official Installer</h6>
                    <p>Download the installer from the official website: <a href="https://nodejs.org/" target="_blank">nodejs.org</a></p>

                    <h5>Verify Installation</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Check Node.js version
node --version

# Check npm version
npm --version

# Check npx version
npx --version</code></pre>
                    {% endraw %}

                    <h5>Setting Up Your Development Environment</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Initialize a new Node.js project
mkdir my-node-app
cd my-node-app
npm init -y

# Install Express.js for web applications
npm install express

# Install nodemon for auto-restarting during development
npm install --save-dev nodemon

# Create a basic server
echo "const express = require('express');
const app = express();
const port = process.env.PORT || 3000;

app.get('/', (req, res) => {
  res.send('Hello World!');
});

app.listen(port, () => {
  console.log(`Server running on port ${port}`);
});" > server.js

# Add start script to package.json
npm pkg set scripts.start "nodemon server.js"

# Start the development server
npm start</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 3: Core Concepts -->
            <div class="content-card" id="module3">
                <div class="card-header">
                    <i class="fas fa-code"></i> Module 3: Core Concepts
                </div>
                <div class="card-body">
                    <h5>Event Loop</h5>
                    <p>The event loop is what allows Node.js to perform non-blocking I/O operations despite being single-threaded. It's the mechanism that takes callbacks (functions) and registers them to be executed at some later time.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Example of event loop behavior
console.log('Start');

setTimeout(() => {
    console.log('Timeout 1');
}, 0);

setTimeout(() => {
    console.log('Timeout 2');
}, 0);

Promise.resolve().then(() => {
    console.log('Promise 1');
});

Promise.resolve().then(() => {
    console.log('Promise 2');
});

console.log('End');

// Output order:
// Start
// End
// Promise 1
// Promise 2
// Timeout 1
// Timeout 2</code></pre>
                    {% endraw %}

                    <h5>Modules</h5>
                    <p>Node.js uses the CommonJS module system by default. Each file is treated as a separate module.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// math.js - Exporting functions
function add(a, b) {
    return a + b;
}

function subtract(a, b) {
    return a - b;
}

// Export individual functions
exports.add = add;
exports.subtract = subtract;

// Or export an object
module.exports = {
    add,
    subtract,
    multiply: (a, b) => a * b
};

// app.js - Importing modules
const math = require('./math');
const { add, subtract } = require('./math');

console.log(add(5, 3));        // 8
console.log(subtract(5, 3));   // 2
console.log(math.multiply(5, 3)); // 15</code></pre>
                    {% endraw %}

                    <h5>Global Objects</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Global objects available in Node.js
console.log(__filename);  // Current file path
console.log(__dirname);    // Directory path of current file
console.log(process.cwd()); // Current working directory

// Process object
console.log(process.env.NODE_ENV); // Environment variables
console.log(process.argv);        // Command line arguments
console.log(process.pid);         // Process ID
console.log(process.platform);    // Operating system platform

// Global functions
setTimeout(() => {
    console.log('Delayed execution');
}, 1000);

setInterval(() => {
    console.log('Repeated execution');
}, 1000);

// Buffer (Node.js specific)
const buf = Buffer.from('Hello World');
console.log(buf.toString()); // Hello World</code></pre>
                    {% endraw %}

                    <h5>Callback Pattern</h5>
                    <p>Callbacks are functions passed as arguments to other functions, which are then invoked inside the outer function to complete some kind of routine or action.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Synchronous callback
function greet(name, callback) {
    console.log(`Hello, ${name}!`);
    callback();
}

greet('Alice', () => {
    console.log('Callback executed');
});

// Asynchronous callback
function fetchData(callback) {
    setTimeout(() => {
        callback('Data fetched');
    }, 1000);
}

fetchData((data) => {
    console.log(data);
});

// Callback hell (nested callbacks)
fs.readFile('file1.txt', 'utf8', (err, data1) => {
    if (err) throw err;
    fs.readFile('file2.txt', 'utf8', (err, data2) => {
        if (err) throw err;
        fs.readFile('file3.txt', 'utf8', (err, data3) => {
            if (err) throw err;
            console.log(data1, data2, data3);
        });
    });
});</code></pre>
                    {% endraw %}

                    <h5>Promises and Async/Await</h5>
                    <p>Promises provide a cleaner way to handle asynchronous operations, avoiding callback hell.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Creating a promise
const myPromise = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('Promise resolved');
    }, 1000);
});

// Using promises
myPromise
    .then(result => console.log(result))
    .catch(error => console.error(error));

// Async/await syntax
async function fetchData() {
    try {
        const data = await myPromise;
        console.log(data);
    } catch (error) {
        console.error(error);
    }
}

fetchData();

// Promise.all for parallel operations
const promise1 = Promise.resolve('One');
const promise2 = Promise.resolve('Two');
const promise3 = Promise.resolve('Three');

Promise.all([promise1, promise2, promise3])
    .then(results => console.log(results))
    .catch(error => console.error(error));</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 4: File System Operations -->
            <div class="content-card" id="module4">
                <div class="card-header">
                    <i class="fas fa-folder"></i> Module 4: File System Operations
                </div>
                <div class="card-body">
                    <h5>File System Module</h5>
                    <p>Node.js provides a built-in fs module for file system operations. It offers both synchronous and asynchronous methods.</p>
                    
                    <h5>Synchronous vs Asynchronous</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const fs = require('fs');
const path = require('path');

// Asynchronous operations (recommended)
fs.readFile('example.txt', 'utf8', (err, data) => {
    if (err) {
        console.error('Error reading file:', err);
        return;
    }
    console.log('File content:', data);
});

// Synchronous operations (blocking)
try {
    const data = fs.readFileSync('example.txt', 'utf8');
    console.log('File content:', data);
} catch (err) {
    console.error('Error reading file:', err);
}

// Promise-based operations (fs.promises)
const fsPromises = require('fs').promises;

async function readFileAsync() {
    try {
        const data = await fsPromises.readFile('example.txt', 'utf8');
        console.log('File content:', data);
    } catch (err) {
        console.error('Error reading file:', err);
    }
}

readFileAsync();</code></pre>
                    {% endraw %}

                    <h5>File Operations</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const fs = require('fs');
const path = require('path');

// Create directory
const dirPath = path.join(__dirname, 'new-directory');
fs.mkdir(dirPath, { recursive: true }, (err) => {
    if (err) throw err;
    console.log('Directory created');
});

// Write file
const filePath = path.join(dirPath, 'test.txt');
const content = 'Hello, Node.js!';

fs.writeFile(filePath, content, 'utf8', (err) => {
    if (err) throw err;
    console.log('File written');
});

// Read file
fs.readFile(filePath, 'utf8', (err, data) => {
    if (err) throw err;
    console.log('File content:', data);
});

// Append to file
fs.appendFile(filePath, '\nAppended content', 'utf8', (err) => {
    if (err) throw err;
    console.log('Content appended');
});

// Delete file
fs.unlink(filePath, (err) => {
    if (err) throw err;
    console.log('File deleted');
});</code></pre>
                    {% endraw %}

                    <h5>Working with Directories</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Read directory contents
fs.readdir(__dirname, (err, files) => {
    if (err) throw err;
    console.log('Directory contents:', files);
    
    // Filter only JavaScript files
    const jsFiles = files.filter(file => path.extname(file) === '.js');
    console.log('JavaScript files:', jsFiles);
});

// Create directory recursively
const createDirRecursive = (dirPath) => {
    fs.mkdir(dirPath, { recursive: true }, (err) => {
        if (err) throw err;
        console.log(`Directory created: ${dirPath}`);
    });
};

createDirRecursive(path.join(__dirname, 'nested', 'directory'));

// Watch directory for changes
fs.watch(__dirname, (eventType, filename) => {
    console.log(`Event type: ${eventType}`);
    console.log(`Filename: ${filename}`);
});</code></pre>
                    {% endraw %}

                    <h5>Path Operations</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const path = require('path');

// Join path segments
const fullPath = path.join(__dirname, 'files', 'data.txt');
console.log(fullPath);

// Get directory name
const dir = path.dirname('/path/to/file.txt');
console.log(dir); // /path/to

// Get file extension
const ext = path.extname('/path/to/file.txt');
console.log(ext); // .txt

// Get file name
const filename = path.basename('/path/to/file.txt');
console.log(filename); // file.txt

// Parse path
const parsedPath = path.parse('/path/to/file.txt');
console.log(parsedPath);
// {
//   root: '/',
//   dir: '/path/to',
//   base: 'file.txt',
//   ext: '.txt',
//   name: 'file'
// }</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 5: HTTP Module and Web Servers -->
            <div class="content-card" id="module5">
                <div class="card-header">
                    <i class="fas fa-globe"></i> Module 5: HTTP Module and Web Servers
                </div>
                <div class="card-body">
                    <h5>HTTP Module</h5>
                    <p>Node.js has a built-in HTTP module to create HTTP servers and clients. It provides a low-level API for HTTP transactions.</p>
                    
                    <h5>Creating a Basic HTTP Server</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const http = require('http');
const url = require('url');

// Create HTTP server
const server = http.createServer((req, res) => {
    // Parse URL
    const parsedUrl = url.parse(req.url, true);
    const path = parsedUrl.pathname;
    const method = req.method;

    // Set response headers
    res.setHeader('Content-Type', 'application/json');

    // Basic routing
    if (path === '/' && method === 'GET') {
        res.writeHead(200);
        res.end(JSON.stringify({ message: 'Welcome to Node.js Server!' }));
    } else if (path === '/api/users' && method === 'GET') {
        res.writeHead(200);
        res.end(JSON.stringify([
            { id: 1, name: 'John Doe', email: 'john@example.com' },
            { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
        ]));
    } else {
        res.writeHead(404);
        res.end(JSON.stringify({ error: 'Route not found' }));
    }
});

// Start server
const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});</code></pre>
                    {% endraw %}

                    <h5>HTTP Client</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const http = require('http');
const https = require('https');

// Making GET request
const options = {
    hostname: 'jsonplaceholder.typicode.com',
    path: '/posts/1',
    method: 'GET'
};

const req = http.request(options, (res) => {
    let data = '';
    
    res.on('data', (chunk) => {
        data += chunk;
    });
    
    res.on('end', () => {
        console.log('Response:', JSON.parse(data));
    });
});

req.on('error', (err) => {
    console.error('Request error:', err);
});

req.end();

// Making POST request
const postData = JSON.stringify({
    title: 'foo',
    body: 'bar',
    userId: 1
});

const postOptions = {
    hostname: 'jsonplaceholder.typicode.com',
    path: '/posts',
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Content-Length': Buffer.byteLength(postData)
    }
};

const postReq = http.request(postOptions, (res) => {
    let data = '';
    
    res.on('data', (chunk) => {
        data += chunk;
    });
    
    res.on('end', () => {
        console.log('Response:', JSON.parse(data));
    });
});

postReq.on('error', (err) => {
    console.error('Request error:', err);
});

postReq.write(postData);
postReq.end();</code></pre>
                    {% endraw %}

                    <h5>Request and Response Objects</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const http = require('http');

const server = http.createServer((req, res) => {
    // Request object properties
    console.log('Method:', req.method);
    console.log('URL:', req.url);
    console.log('Headers:', req.headers);
    console.log('HTTP Version:', req.httpVersion);
    
    // Response methods
    res.statusCode = 200;
    res.setHeader('Content-Type', 'text/plain');
    res.write('Hello World');
    res.end();
});

server.listen(3000);</code></pre>
                    {% endraw %}

                    <h5>Handling Different HTTP Methods</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const http = require('http');

const server = http.createServer((req, res) => {
    const { method, url } = req;
    
    if (method === 'GET' && url === '/') {
        res.writeHead(200, { 'Content-Type': 'text/plain' });
        res.end('GET request received');
    } else if (method === 'POST' && url === '/') {
        let body = '';
        
        req.on('data', chunk => {
            body += chunk.toString();
        });
        
        req.on('end', () => {
            res.writeHead(200, { 'Content-Type': 'text/plain' });
            res.end(`POST request received with body: ${body}`);
        });
    } else if (method === 'PUT' && url === '/') {
        res.writeHead(200, { 'Content-Type': 'text/plain' });
        res.end('PUT request received');
    } else if (method === 'DELETE' && url === '/') {
        res.writeHead(200, { 'Content-Type': 'text/plain' });
        res.end('DELETE request received');
    } else {
        res.writeHead(404, { 'Content-Type': 'text/plain' });
        res.end('404 Not Found');
    }
});

server.listen(3000);</code></pre>
                    {% endraw %}

                    <h5>Handling Request Body</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const http = require('http');

const server = http.createServer((req, res) => {
    if (req.method === 'POST' && req.url === '/api/data') {
        let body = '';
        
        req.on('data', chunk => {
            body += chunk.toString();
        });
        
        req.on('end', () => {
            try {
                const data = JSON.parse(body);
                res.writeHead(200, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({ 
                    message: 'Data received', 
                    data 
                }));
            } catch (error) {
                res.writeHead(400, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({ error: 'Invalid JSON' }));
            }
        });
    } else {
        res.writeHead(404, { 'Content-Type': 'text/plain' });
        res.end('404 Not Found');
    }
});

server.listen(3000);</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 6: Express.js Framework -->
            <div class="content-card" id="module6">
                <div class="card-header">
                    <i class="fas fa-rocket"></i> Module 6: Express.js Framework
                </div>
                <div class="card-body">
                    <h5>Introduction to Express.js</h5>
                    <p>Express.js is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. It simplifies the process of building web servers and APIs.</p>
                    
                    <h5>Setting up Express</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Initialize npm project
npm init -y

# Install Express
npm install express

# Install additional useful packages
npm install cors helmet morgan dotenv</code></pre>
                    {% endraw %}

                    <h5>Basic Express Server</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const express = require('express');
const app = express();

// Middleware
app.use(express.json()); // Parse JSON bodies
app.use(express.urlencoded({ extended: true })); // Parse URL-encoded bodies

// Routes
app.get('/', (req, res) => {
    res.json({ message: 'Welcome to Express Server!' });
});

app.get('/api/users', (req, res) => {
    const users = [
        { id: 1, name: 'John Doe', email: 'john@example.com' },
        { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
    ];
    res.json(users);
});

// Start server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Express server running on port ${PORT}`);
});</code></pre>
                    {% endraw %}

                    <h5>Middleware</h5>
                    <p>Middleware functions are functions that have access to the request object (req), the response object (res), and the next function in the application's request-response cycle.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Application-level middleware
app.use((req, res, next) => {
    console.log(`${new Date().toISOString()} - ${req.method} ${req.url}`);
    next();
});

// Route-specific middleware
const requireAuth = (req, res, next) => {
    const authHeader = req.headers.authorization;
    
    if (!authHeader || authHeader !== 'Bearer secret-token') {
        return res.status(401).json({ error: 'Unauthorized' });
    }
    
    next();
};

app.get('/protected', requireAuth, (req, res) => {
    res.json({ message: 'Protected data' });
});

// Error-handling middleware
app.use((err, req, res, next) => {
    console.error(err.stack);
    res.status(500).json({ error: 'Something went wrong!' });
});</code></pre>
                    {% endraw %}

                    <h5>Routing</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Route parameters
app.get('/users/:id', (req, res) => {
    const { id } = req.params;
    res.json({ userId: id });
});

// Query parameters
app.get('/search', (req, res) => {
    const { q, page = 1, limit = 10 } = req.query;
    res.json({ query: q, page: parseInt(page), limit: parseInt(limit) });
});

// Router module
const express = require('express');
const router = express.Router();

router.get('/users', (req, res) => {
    res.json([{ id: 1, name: 'John' }, { id: 2, name: 'Jane' }]);
});

app.use('/api', router);</code></pre>
                    {% endraw %}

                    <h5>Static Files</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const path = require('path');

// Serve static files from 'public' directory
app.use(express.static(path.join(__dirname, 'public')));

// Example: Access files
// http://localhost:3000/styles.css
// http://localhost:3000/js/app.js
// http://localhost:3000/images/logo.png</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 7: Database Integration -->
            <div class="content-card" id="module7">
                <div class="card-header">
                    <i class="fas fa-database"></i> Module 7: Database Integration
                </div>
                <div class="card-body">
                    <h5>Introduction to Database Integration</h5>
                    <p>Node.js can integrate with various databases including SQL (MySQL, PostgreSQL) and NoSQL (MongoDB, Redis) databases. Here we'll cover examples with MongoDB and MySQL.</p>
                    
                    <h5>MongoDB with Mongoose</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install Mongoose
npm install mongoose</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const mongoose = require('mongoose');

// Connect to MongoDB
mongoose.connect('mongodb://localhost:27017/myapp', {
    useNewUrlParser: true,
    useUnifiedTopology: true
});

// Define schema
const userSchema = new mongoose.Schema({
    name: { type: String, required: true },
    email: { type: String, required: true, unique: true },
    age: { type: Number, min: 0 },
    createdAt: { type: Date, default: Date.now }
});

// Create model
const User = mongoose.model('User', userSchema);

// CRUD Operations
async function createUser(userData) {
    try {
        const user = new User(userData);
        await user.save();
        return user;
    } catch (error) {
        throw error;
    }
}

// Express routes with Mongoose
const express = require('express');
const router = express.Router();

router.post('/users', async (req, res) => {
    try {
        const user = await createUser(req.body);
        res.status(201).json(user);
    } catch (error) {
        res.status(400).json({ error: error.message });
    }
});

module.exports = router;</code></pre>
                    {% endraw %}

                    <h5>MySQL with Sequelize</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install Sequelize and MySQL driver
npm install sequelize mysql2</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const { Sequelize, DataTypes } = require('sequelize');

// Initialize Sequelize
const sequelize = new Sequelize('myapp', 'username', 'password', {
    host: 'localhost',
    dialect: 'mysql'
});

// Define model
const User = sequelize.define('User', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    name: {
        type: DataTypes.STRING,
        allowNull: false
    },
    email: {
        type: DataTypes.STRING,
        allowNull: false,
        unique: true
    }
});

// Sync database
sequelize.sync({ force: false }).then(() => {
    console.log('Database synchronized');
});

// CRUD Operations
async function createUser(userData) {
    try {
        const user = await User.create(userData);
        return user;
    } catch (error) {
        throw error;
    }
}</code></pre>
                    {% endraw %}

                    <h5>Redis for Caching</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install Redis client
npm install redis</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const redis = require('redis');

// Create Redis client
const client = redis.createClient({
    host: process.env.REDIS_HOST || 'localhost',
    port: process.env.REDIS_PORT || 6379
});

client.on('error', (err) => {
    console.error('Redis Client Error', err);
});

client.on('connect', () => {
    console.log('Connected to Redis');
});

// Set and get values
client.set('key', 'value', (err, reply) => {
    if (err) throw err;
    console.log('Value set:', reply);
});

client.get('key', (err, reply) => {
    if (err) throw err;
    console.log('Value:', reply);
});

// Cache middleware
const cache = (duration = 300) => {
    return async (req, res, next) => {
        const key = req.originalUrl;
        
        try {
            // Try to get data from cache
            const cachedData = await client.get(key);
            
            if (cachedData) {
                return res.json(JSON.parse(cachedData));
            }
            
            // Override res.json to cache response
            const originalJson = res.json;
            res.json = function(data) {
                // Cache the response
                client.setex(key, duration, JSON.stringify(data));
                return originalJson.call(this, data);
            };
            
            next();
        } catch (error) {
            next();
        }
    };
};</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 8: Authentication and Security -->
            <div class="content-card" id="module8">
                <div class="card-header">
                    <i class="fas fa-shield-alt"></i> Module 8: Authentication and Security
                </div>
                <div class="card-body">
                    <h5>Authentication in Node.js</h5>
                    <p>Authentication is the process of verifying the identity of a user or system. In Node.js applications, we commonly use JWT (JSON Web Tokens) for authentication.</p>
                    
                    <h5>JWT Authentication</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install JWT and bcrypt
npm install jsonwebtoken bcryptjs</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

// JWT Secret
const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

// Hash password
async function hashPassword(password) {
    const saltRounds = 10;
    return await bcrypt.hash(password, saltRounds);
}

// Compare password
async function comparePassword(password, hashedPassword) {
    return await bcrypt.compare(password, hashedPassword);
}

// Generate JWT token
function generateToken(payload) {
    return jwt.sign(payload, JWT_SECRET, { expiresIn: '24h' });
}

// Verify JWT token
function verifyToken(token) {
    return jwt.verify(token, JWT_SECRET);
}

// Middleware to protect routes
function authenticateToken(req, res, next) {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];

    if (!token) {
        return res.status(401).json({ error: 'Access token required' });
    }

    try {
        const decoded = verifyToken(token);
        req.user = decoded;
        next();
    } catch (error) {
        return res.status(403).json({ error: 'Invalid token' });
    }
}</code></pre>
                    {% endraw %}

                    <h5>Security Best Practices</h5>
                    <ul>
                        <li><strong>Use HTTPS</strong> - Always use HTTPS in production to encrypt data in transit</li>
                        <li><strong>Validate Input</strong> - Always validate and sanitize user input to prevent injection attacks</li>
                        <li><strong>Rate Limiting</strong> - Implement rate limiting to prevent brute force attacks</li>
                        <li><strong>Security Headers</strong> - Use security headers like Helmet.js to set security-related HTTP headers</li>
                        <li><strong>Environment Variables</strong> - Store sensitive data in environment variables, not in code</li>
                    </ul>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const helmet = require('helmet');
const rateLimit = require('express-rate-limit');

// Security headers
app.use(helmet());

// Rate limiting
const limiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100 // Limit each IP to 100 requests per windowMs
});

app.use(limiter);

// Content Security Policy
app.use(helmet.contentSecurityPolicy({
    directives: {
        defaultSrc: ["'self'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        scriptSrc: ["'self'"],
        imgSrc: ["'self'", "data:", "https:"]
    }
}));</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 9: Building RESTful APIs -->
            <div class="content-card" id="module9">
                <div class="card-header">
                    <i class="fas fa-project-diagram"></i> Module 9: Building RESTful APIs
                </div>
                <div class="card-body">
                    <h5>RESTful API Principles</h5>
                    <p>REST (Representational State Transfer) is an architectural style for designing networked applications. It relies on a stateless, client-server protocol, cacheable communications, and a uniform interface.</p>
                    
                    <h5>HTTP Methods in REST</h5>
                    <ul>
                        <li><strong>GET</strong> - Retrieve data</li>
                        <li><strong>POST</strong> - Create new data</li>
                        <li><strong>PUT</strong> - Update existing data</li>
                        <li><strong>PATCH</strong> - Partially update data</li>
                        <li><strong>DELETE</strong> - Delete data</li>
                    </ul>
                    
                    <h5>RESTful API Structure</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// RESTful routes for users resource
// GET /api/users - Get all users
router.get('/users', async (req, res) => {
    try {
        const { page = 1, limit = 10, sort = 'createdAt', order = 'desc' } = req.query;
        
        const offset = (page - 1) * limit;
        const users = await User.findAndCountAll({
            limit: parseInt(limit),
            offset: parseInt(offset),
            order: [[sort, order.toUpperCase()]]
        });
        
        res.json({
            users: users.rows,
            pagination: {
                page: parseInt(page),
                limit: parseInt(limit),
                total: users.count,
                pages: Math.ceil(users.count / limit)
            }
        });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

// GET /api/users/:id - Get user by ID
router.get('/users/:id', async (req, res) => {
    try {
        const { id } = req.params;
        const user = await User.findByPk(id);
        
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }
        
        res.json(user);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

// POST /api/users - Create new user
router.post('/users', async (req, res) => {
    try {
        const { name, email, age } = req.body;
        
        // Validation
        if (!name || !email) {
            return res.status(400).json({ 
                error: 'Name and email are required' 
            });
        }
        
        // Check if user already exists
        const existingUser = await User.findOne({ where: { email } });
        if (existingUser) {
            return res.status(409).json({ 
                error: 'User with this email already exists' 
            });
        }
        
        const user = await User.create({ name, email, age });
        
        res.status(201).json({
            message: 'User created successfully',
            user
        });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

// PUT /api/users/:id - Update user
router.put('/users/:id', async (req, res) => {
    try {
        const { id } = req.params;
        const { name, email, age } = req.body;
        
        const user = await User.findByPk(id);
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }
        
        // Check if email is being changed and if it already exists
        if (email && email !== user.email) {
            const existingUser = await User.findOne({ where: { email } });
            if (existingUser) {
                return res.status(409).json({ 
                    error: 'User with this email already exists' 
                });
            }
        }
        
        await user.update({ name, email, age });
        
        res.json({
            message: 'User updated successfully',
            user
        });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

// DELETE /api/users/:id - Delete user
router.delete('/users/:id', async (req, res) => {
    try {
        const { id } = req.params;
        
        const user = await User.findByPk(id);
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }
        
        await user.destroy();
        
        res.json({
            message: 'User deleted successfully'
        });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});</code></pre>
                    {% endraw %}

                    <h5>API Versioning</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Version 1 API
const v1Router = express.Router();
v1Router.get('/users', (req, res) => {
    res.json({ version: 'v1', users: [] });
});

// Version 2 API
const v2Router = express.Router();
v2Router.get('/users', (req, res) => {
    res.json({ version: 'v2', users: [], metadata: {} });
});

// Mount versioned routes
app.use('/api/v1', v1Router);
app.use('/api/v2', v2Router);</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 10: Error Handling -->
            <div class="content-card" id="module10">
                <div class="card-header">
                    <i class="fas fa-exclamation-triangle"></i> Module 10: Error Handling
                </div>
                <div class="card-body">
                    <h5>Error Handling in Node.js</h5>
                    <p>Proper error handling is crucial for building robust Node.js applications. Node.js provides several mechanisms for handling errors, including try-catch blocks, error events, and error-first callbacks.</p>
                    
                    <h5>Synchronous Error Handling</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">try {
    const result = someFunctionThatMightFail();
    console.log(result);
} catch (error) {
    console.error('Error:', error.message);
    // Handle error
}

// Throwing errors
function validateUser(user) {
    if (!user.name) {
        throw new Error('Name is required');
    }
    if (!user.email) {
        throw new Error('Email is required');
    }
    return user;
}</code></pre>
                    {% endraw %}

                    <h5>Asynchronous Error Handling</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Callback error handling
fs.readFile('nonexistent-file.txt', 'utf8', (err, data) => {
    if (err) {
        console.error('Error reading file:', err);
        return;
    }
    console.log('File content:', data);
});

// Promise error handling
Promise.resolve()
    .then(result => {
        throw new Error('Something went wrong');
    })
    .catch(error => {
        console.error('Error:', error.message);
    });

// Async/await error handling
async function readFileAsync() {
    try {
        const data = await fs.promises.readFile('file.txt', 'utf8');
        console.log('File content:', data);
    } catch (error) {
        console.error('Error:', error.message);
    }
}</code></pre>
                    {% endraw %}

                    <h5>Custom Error Classes</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Custom error classes
class AppError extends Error {
    constructor(message, statusCode) {
        super(message);
        this.statusCode = statusCode;
        this.isOperational = true;
        
        Error.captureStackTrace(this, this.constructor);
    }
}

class ValidationError extends AppError {
    constructor(message) {
        super(message, 400);
    }
}

class NotFoundError extends AppError {
    constructor(message = 'Resource not found') {
        super(message, 404);
    }
}

// Error handling middleware
const errorHandler = (err, req, res, next) => {
    let error = { ...err };
    error.message = err.message;

    // Log error
    console.error(err);

    res.status(error.statusCode || 500).json({
        success: false,
        error: error.message || 'Server Error'
    });
};</code></pre>
                    {% endraw %}

                    <h5>Global Error Handlers</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Uncaught exception handler
process.on('uncaughtException', (err) => {
    console.error('Uncaught Exception:', err);
    process.exit(1);
});

// Unhandled promise rejection handler
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 11: Testing Node.js Applications -->
            <div class="content-card" id="module11">
                <div class="card-header">
                    <i class="fas fa-vial"></i> Module 11: Testing Node.js Applications
                </div>
                <div class="card-body">
                    <h5>Testing in Node.js</h5>
                    <p>Testing is essential for building reliable Node.js applications. Popular testing frameworks for Node.js include Jest, Mocha, and Supertest.</p>
                    
                    <h5>Setting up Testing Environment</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install testing dependencies
npm install --save-dev jest supertest nodemon

# Install additional testing libraries
npm install --save-dev @types/jest eslint-plugin-jest</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-json">// package.json scripts
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}</code></pre>
                    {% endraw %}

                    <h5>Unit Testing</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// userController.js
const User = require('../models/User');
const { ValidationError } = require('../utils/errors');

exports.createUser = async (userData) => {
    const { name, email } = userData;
    
    if (!name || !email) {
        throw new ValidationError('Name and email are required');
    }
    
    const existingUser = await User.findOne({ where: { email } });
    if (existingUser) {
        throw new ValidationError('User with this email already exists');
    }
    
    return await User.create(userData);
};

// userController.test.js
const { createUser } = require('../controllers/userController');
const User = require('../models/User');
const { ValidationError } = require('../utils/errors');

// Mock the User model
jest.mock('../models/User');

describe('User Controller', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });

    describe('createUser', () => {
        it('should create a user with valid data', async () => {
            const userData = { name: 'John Doe', email: 'john@example.com' };
            const mockUser = { id: 1, ...userData };
            
            User.findOne.mockResolvedValue(null);
            User.create.mockResolvedValue(mockUser);
            
            const result = await createUser(userData);
            
            expect(User.findOne).toHaveBeenCalledWith({ where: { email: userData.email } });
            expect(User.create).toHaveBeenCalledWith(userData);
            expect(result).toEqual(mockUser);
        });

        it('should throw ValidationError when name is missing', async () => {
            const userData = { email: 'john@example.com' };
            
            await expect(createUser(userData)).rejects.toThrow(ValidationError);
        });
    });
});</code></pre>
                    {% endraw %}

                    <h5>Integration Testing</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// app.test.js
const request = require('supertest');
const app = require('../app');
const User = require('../models/User');

describe('User API', () => {
    beforeEach(async () => {
        await User.destroy({ where: {} });
    });

    describe('POST /api/users', () => {
        it('should create a new user', async () => {
            const userData = {
                name: 'John Doe',
                email: 'john@example.com',
                age: 30
            };

            const response = await request(app)
                .post('/api/users')
                .send(userData)
                .expect(201);

            expect(response.body).toHaveProperty('message');
            expect(response.body).toHaveProperty('user');
            expect(response.body.user.name).toBe(userData.name);
        });
    });
});</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 12: Performance Optimization -->
            <div class="content-card" id="module12">
                <div class="card-header">
                    <i class="fas fa-tachometer-alt"></i> Module 12: Performance Optimization
                </div>
                <div class="card-body">
                    <h5>Performance Optimization in Node.js</h5>
                    <p>Optimizing Node.js applications is crucial for handling high traffic and ensuring scalability. Here are some key techniques:</p>
                    
                    <h5>Caching with Redis</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const redis = require('redis');

// Create Redis client
const client = redis.createClient({
    host: process.env.REDIS_HOST || 'localhost',
    port: process.env.REDIS_PORT || 6379
});

// Cache middleware
const cache = (duration = 300) => {
    return async (req, res, next) => {
        const key = req.originalUrl;
        
        try {
            // Try to get data from cache
            const cachedData = await client.get(key);
            
            if (cachedData) {
                return res.json(JSON.parse(cachedData));
            }
            
            // Override res.json to cache response
            const originalJson = res.json;
            res.json = function(data) {
                // Cache the response
                client.setex(key, duration, JSON.stringify(data));
                return originalJson.call(this, data);
            };
            
            next();
        } catch (error) {
            next();
        }
    };
};</code></pre>
                    {% endraw %}

                    <h5>Compression</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install compression middleware
npm install compression</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const compression = require('compression');

// Enable compression for all requests
app.use(compression({
    filter: (req, res) => {
        if (req.headers['x-no-compression']) {
            return false;
        }
        return compression.filter(req, res);
    },
    level: 6, // Compression level (1-9)
    threshold: 1024, // Only compress responses larger than 1KB
    windowBits: 15,
    memLevel: 8
}));</code></pre>
                    {% endraw %}

                    <h5>Cluster Mode</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const cluster = require('cluster');
const os = require('os');

if (cluster.isMaster) {
    const numCPUs = os.cpus().length;
    
    console.log(`Master ${process.pid} is running`);
    
    // Fork workers
    for (let i = 0; i < numCPUs; i++) {
        cluster.fork();
    }
    
    cluster.on('exit', (worker, code, signal) => {
        console.log(`Worker ${worker.process.pid} died`);
        cluster.fork(); // Restart worker
    });
} else {
    const app = express();
    const PORT = process.env.PORT || 3000;
    
    app.get('/', (req, res) => {
        res.send(`Hello from Worker ${process.pid}`);
    });
    
    app.listen(PORT, () => {
        console.log(`Worker ${process.pid} started`);
    });
}</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 13: Streams and Buffers -->
            <div class="content-card" id="module13">
                <div class="card-header">
                    <i class="fas fa-stream"></i> Module 13: Streams and Buffers
                </div>
                <div class="card-body">
                    <h5>Streams in Node.js</h5>
                    <p>Streams are objects that let you read data from a source or write data to a destination in a continuous fashion. In Node.js, streams are used for handling large files, network communications, and more.</p>
                    
                    <h5>Readable Streams</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const fs = require('fs');

// Create readable stream
const readableStream = fs.createReadStream('large-file.txt', {
    encoding: 'utf8',
    highWaterMark: 1024 // Buffer size
});

// Handle stream events
readableStream.on('data', (chunk) => {
    console.log('Received chunk:', chunk.length);
});

readableStream.on('end', () => {
    console.log('Stream ended');
});

readableStream.on('error', (err) => {
    console.error('Stream error:', err);
});</code></pre>
                    {% endraw %}

                    <h5>Writable Streams</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const fs = require('fs');

// Create writable stream
const writableStream = fs.createWriteStream('output.txt');

// Write to stream
writableStream.write('Hello, World!');
writableStream.end();</code></pre>
                    {% endraw %}

                    <h5>Transform Streams</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const { Transform } = require('stream');

// Uppercase transform stream
const uppercaseStream = new Transform({
    transform(chunk, encoding, callback) {
        this.push(chunk.toString().toUpperCase());
        callback();
    }
});

// Pipe streams
fs.createReadStream('input.txt')
    .pipe(uppercaseStream)
    .pipe(fs.createWriteStream('output.txt'));</code></pre>
                    {% endraw %}

                    <h5>Buffers</h5>
                    <p>Buffers are fixed-size chunks of memory. They are used to handle binary data in Node.js.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Creating buffers
const buf1 = Buffer.from('Hello World');
const buf2 = Buffer.alloc(10);
const buf3 = Buffer.allocUnsafe(10);

// Buffer operations
const buf = Buffer.from('Hello World');
console.log(buf.length); // 11
console.log(buf.toString()); // Hello World

// Buffer comparison
const bufA = Buffer.from('ABC');
const bufB = Buffer.from('ABC');
console.log(bufA.equals(bufB)); // true</code></pre>
                    {% endraw %}
                </div>
            </div>

            <!-- Module 14: Node.js Best Practices -->
            <div class="content-card" id="module14">
                <div class="card-header">
                    <i class="fas fa-star"></i> Module 14: Node.js Best Practices
                </div>
                <div class="card-body">
                    <h5>Project Structure</h5>
                    <p>A well-organized project structure is essential for maintainability and scalability.</p>
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// Recommended project structure
my-node-app/
├── src/
│   ├── controllers/     # Route handlers
│   ├── models/          # Database models
│   ├── routes/          # Route definitions
│   ├── middleware/      # Custom middleware
│   ├── services/        # Business logic
│   ├── utils/           # Utility functions
│   └── config/          # Configuration files
│   └── app.js           # Express app setup
├── tests/               # Test files
├── docs/                # Documentation
├── logs/                # Log files
├── .env                 # Environment variables
├── .gitignore
├── package.json
├── server.js            # Application entry point
└── README.md</code></pre>
                    {% endraw %}

                    <h5>Environment Configuration</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">// config/index.js
require('dotenv').config();

const config = {
    development: {
        port: process.env.PORT || 3000,
        database: {
            host: process.env.DB_HOST || 'localhost',
            port: process.env.DB_PORT || 5432,
            name: process.env.DB_NAME || 'myapp_dev'
        }
    },
    
    production: {
        port: process.env.PORT || 80,
        database: {
            host: process.env.DB_HOST,
            port: process.env.DB_PORT || 5432,
            name: process.env.DB_NAME
        }
    }
};

const env = process.env.NODE_ENV || 'development';
module.exports = config[env];</code></pre>
                    {% endraw %}

                    <h5>Logging</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const winston = require('winston');

// Create logger
const logger = winston.createLogger({
    level: process.env.LOG_LEVEL || 'info',
    format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.errors({ stack: true }),
        winston.format.json()
    ),
    defaultMeta: { service: 'user-service' },
    transports: [
        new winston.transports.Console({
            format: winston.format.simple()
        }),
        new winston.transports.File({
            filename: 'logs/combined.log',
            level: 'error'
        })
    ]
});

// Custom logger methods
logger.logRequest = (req, res, next) => {
    const start = Date.now();
    
    res.on('finish', () => {
        const duration = Date.now() - start;
        logger.info('HTTP Request', {
            method: req.method,
            url: req.url,
            status: res.statusCode,
            duration: `${duration}ms`
        });
    });
    
    next();
};</code></pre>
                    {% endraw %}

                    <h5>Security Best Practices</h5>
                    <ul>
                        <li>Use HTTPS in production</li>
                        <li>Validate and sanitize all user input</li>
                        <li>Implement rate limiting</li>
                        <li>Use security headers like Helmet.js</li>
                        <li>Store sensitive data in environment variables</li>
                        <li>Keep dependencies updated</li>
                    </ul>
                </div>
            </div>

            <!-- Module 15: Real-World Examples -->
            <div class="content-card" id="module15">
                <div class="card-header">
                    <i class="fas fa-lightbulb"></i> Module 15: Real-World Examples
                </div>
                <div class="card-body">
                    <h5>File Upload Service</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install multer for file uploads
npm install multer</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const multer = require('multer');
const path = require('path');

// Configure multer for file uploads
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        const uploadDir = 'uploads/';
        if (!fs.existsSync(uploadDir)) {
            fs.mkdirSync(uploadDir, { recursive: true });
        }
        cb(null, uploadDir);
    },
    filename: (req, file, cb) => {
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
        cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
    }
});

// Single file upload
app.post('/upload', upload.single('file'), (req, res) => {
    if (!req.file) {
        return res.status(400).json({ error: 'No file uploaded' });
    }
    
    res.json({
        message: 'File uploaded successfully',
        file: {
            filename: req.file.filename,
            originalname: req.file.originalname,
            size: req.file.size,
            mimetype: req.file.mimetype
        }
    });
});</code></pre>
                    {% endraw %}

                    <h5>Email Service</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install nodemailer
npm install nodemailer</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const nodemailer = require('nodemailer');

// Create transporter
const createTransporter = () => {
    return nodemailer.createTransporter({
        host: process.env.SMTP_HOST,
        port: process.env.SMTP_PORT || 587,
        secure: false,
        auth: {
            user: process.env.SMTP_USER,
            pass: process.env.SMTP_PASS
        }
    });
};

// Send email
const sendEmail = async (options) => {
    try {
        const transporter = createTransporter();
        
        const mailOptions = {
            from: process.env.SMTP_FROM,
            to: options.to,
            subject: options.subject,
            text: options.text,
            html: options.html
        };
        
        const info = await transporter.sendMail(mailOptions);
        console.log('Email sent: ' + info.messageId);
        return info;
    } catch (error) {
        console.error('Error sending email:', error);
        throw error;
    }
};</code></pre>
                    {% endraw %}

                    <h5>WebSocket Chat Server</h5>
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-bash"># Install socket.io
npm install socket.io</code></pre>
                    {% endraw %}
                    
                    {% raw %}
                    <pre><button class="copy-button">Copy</button><code class="language-javascript">const http = require('http');
const socketIo = require('socket.io');

const server = http.createServer(app);
const io = socketIo(server, {
    cors: {
        origin: process.env.CLIENT_URL || "http://localhost:3000",
        methods: ["GET", "POST"]
    }
});

// Store connected users
const users = new Map();

// Socket connection handling
io.on('connection', (socket) => {
    console.log('User connected:', socket.id);
    
    // Handle user joining
    socket.on('join', (userData) => {
        users.set(socket.id, {
            id: socket.id,
            name: userData.name,
            room: userData.room
        });
        
        socket.join(userData.room);
        
        // Notify others in the room
        socket.to(userData.room).emit('userJoined', {
            name: userData.name,
            id: socket.id
        });
    });
    
    // Handle chat messages
    socket.on('chatMessage', (messageData) => {
        const user = users.get(socket.id);
        if (user) {
            const message = {
                id: Date.now(),
                user: user.name,
                userId: socket.id,
                text: messageData.text,
                timestamp: new Date().toISOString()
            };
            
            // Broadcast to room
            io.to(user.room).emit('newMessage', message);
        }
    });
    
    // Handle disconnect
    socket.on('disconnect', () => {
        const user = users.get(socket.id);
        if (user) {
            users.delete(socket.id);
            
            // Notify others in the room
            socket.to(user.room).emit('userLeft', {
                name: user.name,
                id: socket.id
            });
        }
    });
});</code></pre>
                    {% endraw %}
                </div>
            </div>

            <div class="mt-5 text-center">
                <a href="/practice" class="btn btn-primary btn-lg">Take Practice Test</a>
            </div>

            <div id="animation-container-docs" style="position: <div class="mt-5 text-center">
                <a href="/practice" class="btn btn-primary btn-lg">Take Practice Test</a>
            </div>
        </div>
    </div>

    <script>
        // Smooth scrolling for sidebar navigation
        document.querySelectorAll('.sidebar .nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
                // Update active state
                document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Search functionality
        document.getElementById('search-input').addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const content = document.getElementById('content');
            const elements = content.querySelectorAll('h2, h3, h4, h5, h6, p, pre, .card');
            
            elements.forEach(element => {
                const text = element.textContent.toLowerCase();
                if (query === '' || text.includes(query)) {
                    element.style.display = '';
                } else {
                    element.style.display = 'none';
                }
            });
        });

        // Clear search function
        function clearSearch() {
            document.getElementById('search-input').value = '';
            const content = document.getElementById('content');
            const elements = content.querySelectorAll('h2, h3, h4, h5, h6, p, pre, .card');
            elements.forEach(element => {
                element.style.display = '';
            });
        }

        // Copy to clipboard functionality
        const copyButtons = document.querySelectorAll('.copy-button');
        copyButtons.forEach(button => {
            button.addEventListener('click', function() {
                const code = this.parentNode.querySelector('code').textContent;
                navigator.clipboard.writeText(code);
                this.textContent = 'Copied!';
                setTimeout(() => {
                    this.textContent = 'Copy';
                }, 2000);
            });
        });

        // Highlight active section in sidebar based on scroll position
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('[id]');
            const navLinks = document.querySelectorAll('.sidebar .nav-link');

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        // Initialize all elements to be visible on page load
        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('content');
            const elements = content.querySelectorAll('h2, h3, h4, h5, h6, p, pre, .card');
            elements.forEach(element => {
                element.style.display = '';
            });
        });
    </script>
{% endblock %}